# Cloud Cost Analyzer 使用指南

## 🚀 快速开始

### 安装
```bash
git clone https://github.com/songqipeng/cloud-cost-analyzer.git
cd cloud-cost-analyzer
pip install -e .
```

### 配置云服务凭证
```bash
# 选择一个或多个云平台配置凭证

# AWS
export AWS_ACCESS_KEY_ID="AKIA..."
export AWS_SECRET_ACCESS_KEY="..."
export AWS_DEFAULT_REGION="us-east-1"

# 阿里云
export ALIBABA_CLOUD_ACCESS_KEY_ID="LTAI..."
export ALIBABA_CLOUD_ACCESS_KEY_SECRET="..."

# 腾讯云
export TENCENTCLOUD_SECRET_ID="AKIDxxx..."
export TENCENTCLOUD_SECRET_KEY="..."

# 火山云
export VOLCENGINE_ACCESS_KEY_ID="AKLT..."
export VOLCENGINE_SECRET_ACCESS_KEY="..."
```

## 📊 使用方法

### 检查连接状态
```bash
python cloud_cost_analyzer.py config
```

### 快速分析（推荐）
```bash
# 自动选择第一个可用的云平台，分析过去1年费用
python cloud_cost_analyzer.py quick
```

### 多云对比分析
```bash
# 对比所有已配置的云平台费用
python cloud_cost_analyzer.py multi-cloud
```

### 自定义时间范围分析
```bash
# 指定时间范围
python cloud_cost_analyzer.py custom --start 2024-01-01 --end 2024-12-31
```

## 🔧 输出选项

```bash
# 指定输出目录
python cloud_cost_analyzer.py multi-cloud --output ./reports

# 指定输出格式
python cloud_cost_analyzer.py quick --format txt
python cloud_cost_analyzer.py quick --format html  
python cloud_cost_analyzer.py quick --format all
```

## 📋 输出示例

### 多云费用对比
```
┏━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━┳━━━━━━━━━┳━━━━━━━━━━━━━━┓
┃ 云平台       ┃       总费用 ┃  货币   ┃ 平均每日费用 ┃
┡━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━╇━━━━━━━━━╇━━━━━━━━━━━━━━┩
│ AWS          │        34.07 │   USD   │        17.03 │
│ 阿里云       │       125.50 │   CNY   │        62.75 │
│ 腾讯云       │        89.20 │   CNY   │        44.60 │
│ 火山云       │        67.80 │   CNY   │        33.90 │
└──────────────┴──────────────┴─────────┴──────────────┘
```

### 生成的报告文件
```
reports/
├── multi_cloud_cost_analysis_20250906_182315.txt
├── multi_cloud_cost_analysis_20250906_182315.html
├── aws_cost_analysis_20250906_184620.txt
└── aws_cost_analysis_20250906_184620.html
```

## ⚙️ 配置文件（可选）

创建 `config.json` 文件进行高级配置：

```json
{
  "cache": {
    "enabled": true,
    "type": "memory"
  },
  "notifications": {
    "email": {
      "enabled": true,
      "smtp_server": "smtp.gmail.com",
      "sender_email": "your-email@gmail.com",
      "recipient_email": "recipient@example.com"
    }
  }
}
```

## ⏰ 定时任务

```bash
# 添加到 crontab，每天早上8点自动分析
crontab -e

# 添加以下行
0 8 * * * cd /path/to/cloud-cost-analyzer && python cloud_cost_analyzer.py multi-cloud >> cron.log 2>&1
```

## 🆘 问题排查

### 连接失败
```bash
# 检查环境变量
env | grep -E "(AWS|ALIBABA|TENCENT|VOLCENGINE)"

# 详细错误信息
python cloud_cost_analyzer.py config 2>&1 | tee debug.log
```

### API 权限要求
- **AWS**: `ce:GetCostAndUsage`, `ce:GetDimensionValues`
- **阿里云**: `AliyunBSSReadOnlyAccess` 
- **腾讯云**: `QcloudBillingReadOnlyAccess`
- **火山云**: `BillingReadOnlyAccess`

详细配置指南：[API_KEYS_GUIDE.md](./API_KEYS_GUIDE.md)